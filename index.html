<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>UBrToVI — Unique Brand Tone of Voice Identifier</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Map competitor tones on Pitch and Register, then identify a clear tonal white space for your brand voice.">
  <link rel="icon" type="image/png" href="favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Prevent infinite canvas growth and ensure stable sizing */
    #chart-wrap { width: 100%; height: 460px; position: relative; }
    #grid { width: 100% !important; height: 100% !important; display: block; }
    .card { box-shadow: 0 8px 30px rgba(0,0,0,.06); }
    .section { width: 100%; }
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">

  <!-- Header (full width) -->
  <header class="bg-white/90 backdrop-blur border-b section">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="favicon.png" alt="UBrToVI" class="w-7 h-7 rounded">
        <span class="font-semibold tracking-tight">UBrToVI</span>
      </div>
      <nav class="text-sm text-neutral-600">
        <a href="#how" class="hover:text-black">How it works</a>
      </nav>
    </div>
  </header>

  <main class="section">

    <!-- Hero (full width image) -->
    <section class="section">
      <img src="hero.png" alt="Brand voice mapping hero" class="w-full max-h-[520px] object-cover">
    </section>

    <!-- Title + input (full width, centred content) -->
    <section class="section bg-white">
      <div class="max-w-6xl mx-auto px-4 py-8">
        <h1 class="text-3xl md:text-4xl font-semibold leading-tight">Unique Brand Tone of Voice Identifier</h1>
        <p class="mt-3 text-neutral-700">Evidence-led brand voice. Map the market. Pick a distinctive position.</p>
        <p class="mt-3 text-sm text-neutral-600">UBrToVI analyses competitor language to benchmark Pitch and Register, then recommends a differentiated tonal position that is strategically coherent and commercially useful.</p>

        <form id="nicheForm" class="mt-6 flex flex-col sm:flex-row gap-3 w-full">
          <input id="niche" required class="flex-1 border rounded-xl px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-black/10" placeholder="eg. South African challenger banks">
          <button class="bg-black text-white px-5 py-2.5 rounded-xl hover:bg-neutral-800 active:scale-[.99]" type="submit">Analyse</button>
        </form>
        <div id="status" class="text-sm text-neutral-700 mt-2"></div>
      </div>
    </section>

    <!-- Chart section (full width) -->
    <section class="section">
      <div class="max-w-6xl mx-auto px-4 pb-8">
        <div class="bg-white rounded-2xl p-4 md:p-6 card">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-semibold">Tone of voice map</h2>
            <div class="text-xs text-neutral-600">X = Pitch. Y = Register.</div>
          </div>

          <!-- Fixed-height chart wrapper stops infinite growth -->
          <div id="chart-wrap">
            <canvas id="grid"></canvas>
          </div>

          <!-- Legend -->
          <div class="mt-3 text-xs text-neutral-700 text-center">
            <span class="inline-flex items-center gap-2 mr-4">
              <span class="inline-block w-3 h-3 rounded-full" style="background:#4b5563"></span> Competitors
            </span>
            <span class="inline-flex items-center gap-2 mr-4">
              <span class="inline-block w-3 h-3 rounded" style="background:#2563eb"></span> Your suggested position
            </span>
            <span class="inline-flex items-center gap-2">
              <span class="inline-block w-3 h-[2px] bg-black"></span> Median axes
            </span>
          </div>

          <!-- Narrative summary -->
          <div id="summary" class="mt-6 grid gap-4"></div>
        </div>

        <!-- How it works (full width) -->
        <section id="how" class="mt-8 grid gap-4">
          <div class="bg-white rounded-2xl p-5 card">
            <h3 class="font-semibold mb-1">Research</h3>
            <p class="text-sm text-neutral-700">We fetch official sites and top properties for prominent brands in your niche, then extract representative copy.</p>
          </div>
          <div class="bg-white rounded-2xl p-5 card">
            <h3 class="font-semibold mb-1">Scoring</h3>
            <p class="text-sm text-neutral-700">Each competitor is scored for <em>Pitch</em> from simple to complex, and <em>Register</em> from casual to formal, on a 1–10 scale.</p>
          </div>
          <div class="bg-white rounded-2xl p-5 card">
            <h3 class="font-semibold mb-1">Positioning</h3>
            <p class="text-sm text-neutral-700">We plot the field, locate the least dense quadrant, and recommend a position that maximises distinctiveness without breaking category norms.</p>
          </div>
        </section>
      </div>
    </section>
  </main>

  <!-- Footer (full width). Logo row then ad row, both links, always visible -->
  <footer class="section bg-white border-t">
    <div class="max-w-6xl mx-auto px-4 py-6">
      <div class="w-full flex items-center gap-3 py-2">
        <a href="https://mikewhyle.com" target="_blank" rel="noopener" class="flex items-center gap-3">
          <img src="mike.png" alt="Mike" class="w-12 h-12 rounded-full object-cover">
          <div class="text-sm">
            <div class="font-medium">Mike</div>
            <div class="text-neutral-600">AI consultant and creative strategist</div>
          </div>
        </a>
        <div class="ml-auto text-sm text-neutral-600">© <span id="year"></span> UBrToVI</div>
      </div>
      <div class="w-full py-2">
        <a href="https://mikewhyle.com/ai/" target="_blank" rel="noopener">
          <img src="ad.png" alt="Promotion" class="w-full max-h-28 object-contain">
        </a>
      </div>
    </div>
  </footer>

<script>
const WORKER_URL = "https://ubrtovi-worker.ubrtovi.workers.dev";

const canvas = document.getElementById('grid');
const ctx = canvas.getContext('2d');
let chart;

/* Bold square frame + dashed medians */
const frameAndCross = {
  id: 'frameAndCross',
  afterDatasetsDraw(chart) {
    const {ctx, chartArea: {left, right, top, bottom}, scales: {x, y}} = chart;
    ctx.save();
    // Frame
    ctx.lineWidth = 2.5;
    ctx.strokeStyle = '#0a0a0a';
    ctx.beginPath();
    ctx.rect(left, top, right - left, bottom - top);
    ctx.stroke();
    // Medians
    const mx = chart.config.options._medianX;
    const my = chart.config.options._medianY;
    if (typeof mx === 'number' && typeof my === 'number') {
      ctx.lineWidth = 1.5;
      ctx.setLineDash([6, 6]);
      ctx.beginPath();
      ctx.moveTo(x.getPixelForValue(mx), top);
      ctx.lineTo(x.getPixelForValue(mx), bottom);
      ctx.moveTo(left, y.getPixelForValue(my));
      ctx.lineTo(right, y.getPixelForValue(my));
      ctx.stroke();
      ctx.setLineDash([]);
    }
    ctx.restore();
  }
};

function renderChart(data) {
  const competitorPts = data.items.map(it => ({ x: it.pitch, y: it.register, brand: it.brand }));
  const suggestionPt = data.suggestion ? [{ x: data.suggestion.pitch, y: data.suggestion.register }] : [];
  const mx = data.medians?.pitch ?? null;
  const my = data.medians?.register ?? null;

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [
        {
          label: 'Competitors',
          data: competitorPts,
          pointRadius: 5,
          backgroundColor: '#4b5563',
          borderColor: '#374151',
          borderWidth: 1
        },
        {
          label: 'Suggested position',
          data: suggestionPt,
          pointRadius: 7,
          pointStyle: 'triangle',
          backgroundColor: '#2563eb',
          borderColor: '#1e40af',
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,   // we control height via #chart-wrap
      resizeDelay: 100,             // avoids resize loops on some browsers
      _medianX: mx,
      _medianY: my,
      scales: {
        x: {
          title: { display: true, text: 'Pitch 1 simple 10 complex', font: { weight: '600' } },
          min: 1, max: 10, ticks: { stepSize: 1 },
          grid: { display: false }
        },
        y: {
          title: { display: true, text: 'Register 1 casual 10 formal', font: { weight: '600' } },
          min: 1, max: 10, ticks: { stepSize: 1 },
          grid: { display: false }
        }
      },
      plugins: {
        legend: { position: 'bottom' },
        tooltip: {
          callbacks: {
            label: ctx => {
              const d = ctx.raw;
              return d.brand ? `${d.brand} (${d.x}, ${d.y})` : `Suggested (${d.x}, ${d.y})`;
            }
          }
        }
      }
    },
    plugins: [frameAndCross]
  });
}

document.getElementById('nicheForm').addEventListener('submit', async e => {
  e.preventDefault();
  const niche = document.getElementById('niche').value.trim();
  const status = document.getElementById('status');
  const summary = document.getElementById('summary');
  status.textContent = "Analysing. Please wait.";
  summary.innerHTML = "";

  try {
    const res = await fetch(WORKER_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ niche })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "Request failed");

    renderChart(data);

    const compCards = data.items.map(it => `
      <div class="p-4 bg-white rounded-xl border">
        <div class="text-sm font-medium">${it.brand}</div>
        <div class="text-xs text-neutral-600 truncate">
          <a href="${it.url}" target="_blank" rel="noreferrer">${it.url}</a>
        </div>
        <div class="text-xs mt-1">Pitch ${it.pitch} • Register ${it.register}</div>
        <div class="text-xs mt-2 text-neutral-700">${it.summary}</div>
      </div>
    `).join("");

    const rationaleBlock = `
      <div class="p-4 bg-neutral-50 rounded-xl border">
        <div class="text-sm"><strong>Niche:</strong> ${data.niche}</div>
        <div class="text-sm mt-1"><strong>Least dense quadrant:</strong> ${data.leastDenseQuadrant ?? 'n/a'}</div>
        <div class="text-sm mt-1"><strong>Suggested position:</strong> ${
          data.suggestion ? `Pitch ${data.suggestion.pitch}, Register ${data.suggestion.register}` : 'n/a'
        }</div>
        <p class="text-sm mt-3 leading-relaxed">${data.rationale || ''}</p>
      </div>
    `;

    summary.innerHTML = `
      ${rationaleBlock}
      <div class="mt-2">
        <h3 class="text-base font-semibold mb-2">Competitor tone snapshots</h3>
        <div class="grid gap-3 md:grid-cols-2">${compCards}</div>
      </div>
    `;

    status.textContent = "Done.";
  } catch (err) {
    status.textContent = `Error: ${err.message}`;
  }
});

document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
